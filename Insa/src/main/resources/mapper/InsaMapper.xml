<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.company.insa.controller.InsaDao">
	
<!--*******************************
직원 등록
**********************************-->
	<!-- 사번 생성용 - 부서코드 호출 -->
	<select id="getAgentNoDeptCode" parameterType="com.company.insa.vo.InsaComVo" resultType="string">
		<![CDATA[
			SELECT CODE FROM INSA.INSA_COM WHERE NAME = #{name}
		 ]]>
	</select>
	<!-- 사번 생성용 - 시퀀스 호출 -->
	<select id="getSeqAgentNo" resultType="string">
		<![CDATA[
			SELECT INSA.SEQ_AGENTNO.NEXTVAL FROM DUAL
		]]>
	</select>
	
	<select id="idCheck" resultType="int">
		<![CDATA[ 
		SELECT COUNT(*) FROM INSA.INSA WHERE id =#{id}
		 ]]>
	</select>
	
	<insert id="input">
		<![CDATA[
			INSERT INTO INSA.INSA
				(agentNo, name, engName, id, pwd, 
				regNo, phone, call, 
				age, sex, email, 
				zip, addr1, addr2, 
				status, putYn, dept, position, jobType, salary, 
				joinDate, retireDate, 
				milYn, milType, milLevel, milStartDate, milEndDate, 
				kosaYn, kosaLevel, grdLevel, 
				cmpRegNo, cmp, cmpFileName, 
				selfIntro, carrierFileName, profileFileName)
			VALUES (#{agentNo}, #{name}, #{engName}, 
				#{id}, #{pwd}, 
				#{regNo}, #{phone}, #{call}, 
				#{age}, #{sex}, #{email}, 
				#{zip}, #{addr1}, #{addr2}, 
				#{status}, #{putYn}, #{dept}, #{position}, #{jobType}, #{salary}, 
				#{joinDate}, #{retireDate}, 
				#{milYn}, #{milType}, #{milLevel}, #{milStartDate}, #{milEndDate},
				#{kosaYn}, #{kosaLevel}, #{grdLevel}, 
				#{cmpRegNo}, #{cmp}, #{cmpFileName}, 
				#{selfIntro}, #{carrierFileName}, #{profileFileName})
		]]>
	</insert>
	
<!--*******************************
직원 검색 조회
**********************************-->
<select id="list" parameterType="com.company.insa.vo.InsaVo" resultType="com.company.insa.vo.InsaVo">
		<![CDATA[
			SELECT rownum, K2.* 
			FROM (SELECT rownum as rnum, K1.* 
				FROM (SELECT * 
				FROM insa WHERE 1=1 
					]]>
				<if test='searchAgentNo != ""'>
			    <![CDATA[  
			    	AND agentNo LIKE'%' || #{searchAgentNo} || '%' 
			    ]]>
				</if>
		
				<if test='searchName != ""'>
			    <![CDATA[  
			    	AND name LIKE'%' || #{searchName} || '%' 
			    ]]>
				</if>
		
				<if test='searchStatus != ""'>
			    <![CDATA[  
			    	AND status = #{searchStatus}
			    ]]>
				</if>
		
				<if test='searchPutYn != ""'>
			    <![CDATA[  
			    	AND putYn = #{searchPutYn} 
			    ]]>
				</if>
		
				<if test='searchPosition != ""'>
			    <![CDATA[  
			    	AND position = #{searchPosition} 
			    ]]>
				</if>
		
				<if test='searchJoinDate != ""'>
			    <![CDATA[  
			    	AND joinDate = #{searchJoinDate} 
			    ]]>
				</if>
		
				<if test='searchRetireDate != ""'>
			    <![CDATA[  
			    	AND retireDate = #{searchRetireDate} 
			    ]]>
				</if>
		
				<if test='searchJobType != ""'>
			    <![CDATA[  
			    	AND jobType = #{searchJobType}
			    ]]>
				</if>
		<![CDATA[
					ORDER BY agentNo DESC) K1 
			WHERE rownum <= #{nowRecord}+9) K2 
		WHERE rnum >= #{nowRecord}
		]]>
	</select>
	
	
	
<!--*******************************
직원 수정
**********************************-->
	<update id="insaUpdate" parameterType="com.company.insa.vo.InsaVo">
		<![CDATA[
			UPDATE insa SET 
				name=#{name},
				engName=#{engName},	
				pwd=#{pwd},
				regNo=#{regNo}, 
				phone=#{phone},
				call=#{call}, 
				age=#{age},
				sex=#{sex}, 
				email=#{email}, 
				zip=#{zip}, 
				addr1=#{addr1}, 
				addr2=#{addr2},
				status=#{status},
				putYn=#{putYn},
				dept=#{dept}, 
				position=#{position}, 
				jobType=#{jobType},
				salary=#{salary},
				retireDate=#{retireDate},
				milYn=#{milYn}, 
				milType=#{milType},	
				milLevel=#{milLevel},	
				milStartDate=#{milStartDate},	
				milEndDate=#{milEndDate},
				kosaYn=#{kosaYn}, 
				kosaLevel=#{kosaLevel},	
				grdLevel=#{grdLevel},
				cmpRegNo=#{cmpRegNo}, 
				cmp=#{cmp},	
				cmpFileName=#{cmpFileName},
				selfIntro=#{selfIntro},
				carrierFileName=#{carrierFileName},
				profileFileName=#{profileFileName}
			WHERE agentNo=#{agentNo}
		]]>
	</update>
	
<!--*******************************
직원 삭제
**********************************-->
	<delete id="insaDeleteByAgentNo" parameterType="com.company.insa.vo.InsaVo">
		<![CDATA[
		DELETE FROM insa WHERE agentNo=#{agentNo}
		]]>
	</delete>
	
	
<!--*******************************
사번으로 사진파일명 가져오기
**********************************-->
	<select id="getProfileFileNameByAgentNo" resultType="String">
	<![CDATA[
		SELECT profile FROM insa WHERE agentNo=#{agentNo}
	]]>
	</select>

	<select id="getCmpFileNameByAgentNo" resultType="String">
	<![CDATA[
		SELECT cmp_reg_img FROM insa WHERE agentNo=#{agentNo}
	]]>
	</select>
	
	<select id="getCarrierFileNameByAgentNo" resultType="String">
	<![CDATA[
	SELECT carrier FROM insa WHERE agentNo=#{agentNo}
	]]>
	</select>
	
	
<!--*******************************
페이징 관련 함수
**********************************-->

	<select id="getTotalRecord"	parameterType="com.company.insa.vo.InsaVo" resultType="Int">
		<![CDATA[
			SELECT count(*) FROM insa WHERE 1 = 1
		]]>
		<if test='searchAgentNo != ""'>
		<![CDATA[  
	    	AND agentNo LIKE'%' || #{searchAgentNo} || '%' 
	    ]]>
		</if>

		<if test='searchName != ""'>
	    <![CDATA[  
	    	AND name LIKE'%' || #{searchName} || '%' 
	    ]]>
		</if>

		<if test='searchStatus != ""'>
	    <![CDATA[  
	    	AND status = #{searchStatus}
	    ]]>
		</if>

		<if test='searchPutYn != ""'>
	    <![CDATA[  
	    	AND putYn = #{searchPutYn} 
	    ]]>
		</if>

		<if test='searchPosition != ""'>
	    <![CDATA[  
	    	AND position = #{searchPosition} 
	    ]]>
		</if>

		<if test='searchJobType != ""'>
	    <![CDATA[  
	    	AND jobType = #{searchJobType}
	    ]]>
		</if>
		
		<if test='searchJoinDate != ""'>
	    <![CDATA[  
	    	AND joinDate = #{searchJoinDate} 
	    ]]>
		</if>

		<if test='searchRetireDate != ""'>
	    <![CDATA[  
	    	AND retireDate = #{searchRetireDate} 
	    ]]>
		</if>

	</select>

	<select id="insaPage" parameterType="string" resultType="com.company.insa.vo.InsaVo">
		<![CDATA[ 
		SELECT * FROM insa WHERE agentNo =#{agentNo}
		 ]]>
	</select>
	
	
	
	
	
	<!-- DB 연결 test용 -->
<!-- 	<select id="testfn" resultType="string">
		<![CDATA[
			SELECT COUNT(*) FROM INSA.INSA_COM
		]]>
	</select> -->
	
</mapper>

